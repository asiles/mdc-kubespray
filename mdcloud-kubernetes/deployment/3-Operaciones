1. Entrar al DashBoard

    https://dashboard.k8s.mediacloud.lab:6443/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/#!/namespace?namespace=default

    Token:

    eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLW1uNTI1Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJkZTVhNTM5Yy00NDIyLTExZTktOTQyYS0wMDUwNTY4MjBmN2QiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06YWRtaW4tdXNlciJ9.NmBd43knegtHi0iTa4emiQRMoVnXQWy1emzYYtfMBCzDddw7p4XVPzk9n8TGszJEeHzcEW7sDvMCJBoGDsN0CsDG3b14Fq0YOGMoTIbduvcSnP36ejclLbPERqBPslw1o51tTAhzyqBdwvxIwIc_m7ud8c-N62OfrDIizN9-Lnj01c_DIsDWhMw32sJG8sCm_MV_Mwnu4v4C1EytoGvW131pAFj-NIDIXAgCNX0d1ejAYZubQP1sYzuaJn5dLb7dcPRbZSs4O0Vy6yCQQk40mfKtTBgszgC0py9Uos2bzg-aI60fLp2ywM-lsTVssrNSZB-dKngVd7iRFeT6kHSJxQ


2. Crear Namespace y usuario para acceder a Ã©l

    Crear Namespace:

        kubectl  --kubeconfig ~/terraform-vsphere-kubespray/config/admin.conf create namespace mynamespace

    
    Crear Service Account:
    
        vim access.yaml

        ####
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: mynamespace-user
  namespace: mynamespace

---
kind: Role
apiVersion: rbac.authorization.k8s.io/v1beta1
metadata:
  name: mynamespace-user-full-access
  namespace: mynamespace
rules:
- apiGroups: ["", "extensions", "apps"]
  resources: ["*"]
  verbs: ["*"]
- apiGroups: ["batch"]
  resources:
  - jobs
  - cronjobs
  verbs: ["*"]

---
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1beta1
metadata:
  name: mynamespace-user-view
  namespace: mynamespace
subjects:
- kind: ServiceAccount
  name: mynamespace-user
  namespace: mynamespace
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: mynamespace-user-full-access
        ####
    
    Deploy:

        kubectl  --kubeconfig ~/terraform-vsphere-kubespray/config/admin.conf create -f access.yaml

    
    Sacar el Token y cert para acceder por dashboard:

        Nombre del Token (EJ: mynamespace-user-token-jw7cm)

            kubectl --kubeconfig ~/terraform-vsphere-kubespray/config/admin.conf describe sa mynamespace-user -n mynamespace

        Cert:

            kubectl --kubeconfig ~/terraform-vsphere-kubespray/config/admin.conf get secret mynamespace-user-token-jw7cm -n mynamespace -o "jsonpath={.data['ca\.crt']}"

        Token:

            kubectl --kubeconfig ~/terraform-vsphere-kubespray/config/admin.conf -n mynamespace describe secret $(kubectl --kubeconfig ~/terraform-vsphere-kubespray/config/admin.conf -n mynamespace get secret | grep mynamespace-user | awk '{print $1}')

        
    

3. Kubeconf para que entre por consola: (http://docs.shippable.com/deploy/tutorial/create-kubeconfig-for-self-hosted-kubernetes-cluster/)

apiVersion: v1
kind: Config
users:
- name: mynamespace-user
  user:
    token: <replace this with token info>
clusters:
- cluster:
    certificate-authority-data: <replace this with certificate-authority-data info>
    server: https://10.0.1.20:6443
  name: cluster.local
contexts:
- context:
    cluster: cluster.local
    user: mynamespace-user
  name: mynamespace
current-context: mynamespace



4. Alias para acceder desde fuera

  Dejar el kubeconfig en /home/usuario

  vim ~/.bashrc

    alias kube-user='kubectl --kubeconfig ~/kubeconf-mynamespace-user -n mynamespace --insecure-skip-tls-verify=true'
  
  source ~/.bashrc


